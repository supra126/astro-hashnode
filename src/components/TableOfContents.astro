---
import type { TocItem } from '../types';

interface Props {
  items: TocItem[];
}

const { items } = Astro.props;

// Build nested structure
function buildTocTree(items: TocItem[]) {
  return items.map((item) => ({
    ...item,
    indent: Math.max(0, item.level - 2), // h2 = 0, h3 = 1, h4 = 2
  }));
}

const tocItems = buildTocTree(items);
---

{tocItems.length > 0 && (
  <nav class="rounded-xl border border-slate-200 p-6 dark:border-slate-800" aria-label="Table of contents">
    <h2 class="mb-4 font-heading text-lg font-bold">Table of Contents</h2>
    <ul class="space-y-2 text-sm">
      {tocItems.map((item) => (
        <li style={`padding-left: ${item.indent * 1}rem`}>
          <a
            href={`#heading-${item.slug}`}
            class="text-slate-600 transition-colors hover:text-blue-600 dark:text-slate-400 dark:hover:text-blue-400"
          >
            {item.title}
          </a>
        </li>
      ))}
    </ul>
  </nav>
)}
